# Feature Specification: 儿童卡通俄罗斯方块游戏

**Feature Branch**: `001-tetris-game`  
**Created**: 2025-12-22  
**Status**: Draft  
**Input**: 创建一个可以用本地浏览器运行的俄罗斯方块游戏，是小朋友玩的，画面友好，是卡通风格，有积分，能记住历史的积分记录，每当打破历史记录的时候，会在页面显示恭喜，烟花效果，根据分数的不同，会有不同的等级显示

## 概述

一款专为儿童设计的浏览器端俄罗斯方块游戏，采用可爱卡通风格，色彩鲜艳友好。游戏包含完整的积分系统、历史记录、等级系统，以及打破记录时的庆祝动画效果。

## User Scenarios & Testing

### User Story 1 - 基础游戏体验 (Priority: P1)

小朋友打开浏览器，看到一个可爱的卡通风格游戏界面，可以通过简单的按键操作（方向键或触屏）控制方块下落、旋转、左右移动，当一行被填满时自动消除并获得积分。

**Why this priority**: 这是游戏的核心功能，没有基础游戏机制，其他功能都无法体验。

**Independent Test**: 可以通过打开游戏页面，使用键盘控制方块移动、旋转、加速下落，完成消行操作来独立测试。

**Acceptance Scenarios**:

1. **Given** 游戏已加载完成，**When** 玩家点击"开始游戏"按钮，**Then** 一个随机方块从顶部开始下落
2. **Given** 方块正在下落，**When** 玩家按左/右方向键，**Then** 方块向对应方向移动一格（如果没有障碍）
3. **Given** 方块正在下落，**When** 玩家按上方向键或空格键，**Then** 方块顺时针旋转90度（如果空间允许）
4. **Given** 方块正在下落，**When** 玩家按下方向键，**Then** 方块加速下落
5. **Given** 一行已被方块完全填满，**When** 方块落定，**Then** 该行消除并播放消除动画，上方方块下落
6. **Given** 方块堆积到顶部，**When** 新方块无法生成，**Then** 游戏结束，显示最终得分

---

### User Story 2 - 积分与等级系统 (Priority: P1)

游戏过程中，小朋友可以看到当前积分和等级。消除行数越多，积分越高。积分达到一定阈值时，等级提升，游戏速度适当加快，同时显示可爱的等级图标。

**Why this priority**: 积分和等级是游戏激励机制的核心，让小朋友有成就感和继续玩的动力。

**Independent Test**: 通过消除不同数量的行，验证积分计算正确，等级在达到阈值时正确提升。

**Acceptance Scenarios**:

1. **Given** 游戏进行中，**When** 消除1行，**Then** 获得100分
2. **Given** 游戏进行中，**When** 同时消除2行，**Then** 获得300分（有连消奖励）
3. **Given** 游戏进行中，**When** 同时消除3行，**Then** 获得500分
4. **Given** 游戏进行中，**When** 同时消除4行（俄罗斯方块！），**Then** 获得800分并显示特殊动画
5. **Given** 当前积分为900分（等级1），**When** 积分达到1000分，**Then** 升级到等级2，显示升级动画，速度适当加快
6. **Given** 当前等级为5，**When** 查看等级显示，**Then** 显示对应的可爱等级图标（如：🐣→🐥→🐤→🐔→🦅→🦄）

**等级系统设计**:

| 等级 | 所需积分 | 图标 | 名称 | 下落速度 |
|------|---------|------|------|---------|
| 1 | 0 | 🐣 | 新手蛋蛋 | 1.0秒/格 |
| 2 | 1000 | 🐥 | 小黄鸡 | 0.9秒/格 |
| 3 | 3000 | 🐤 | 快乐鸟 | 0.8秒/格 |
| 4 | 6000 | 🐔 | 聪明鸡 | 0.7秒/格 |
| 5 | 10000 | 🦅 | 飞翔鹰 | 0.6秒/格 |
| 6 | 15000 | 🦄 | 神奇独角兽 | 0.5秒/格 |
| 7 | 25000 | 🐉 | 传说龙龙 | 0.45秒/格 |
| 8 | 40000 | ⭐ | 超级明星 | 0.4秒/格 |
| 9 | 60000 | 🌟 | 闪耀之星 | 0.35秒/格 |
| 10 | 100000 | 👑 | 方块大王 | 0.3秒/格 |

---

### User Story 3 - 历史记录与破纪录庆祝 (Priority: P2)

游戏会记住小朋友的历史最高分。当打破历史记录时，页面会显示恭喜信息和漂亮的烟花效果，让小朋友感到成就感。

**Why this priority**: 历史记录增加了游戏的长期吸引力，破纪录庆祝让成就感倍增。

**Independent Test**: 通过玩游戏超过历史最高分，验证烟花效果和恭喜信息正确显示，刷新页面后验证记录已保存。

**Acceptance Scenarios**:

1. **Given** 历史最高分为5000分，**When** 当前游戏得分超过5000分，**Then** 立即显示"🎉 新纪录！"提示
2. **Given** 游戏结束且打破了历史记录，**When** 显示结算界面，**Then** 播放烟花动画，显示"恭喜你打破了记录！"
3. **Given** 打破记录后，**When** 刷新页面重新开始游戏，**Then** 新的历史最高分已被保存并显示
4. **Given** 从未玩过游戏，**When** 第一次完成游戏，**Then** 当前得分成为历史最高分
5. **Given** 游戏结束界面，**When** 查看历史记录，**Then** 显示最近5次游戏的得分记录

---

### User Story 4 - 卡通视觉风格 (Priority: P2)

整个游戏采用明亮、可爱的卡通风格，适合儿童审美。方块有圆角和可爱的表情，背景有云朵、彩虹等元素，整体色彩柔和不刺眼。

**Why this priority**: 视觉风格直接影响儿童的第一印象和游戏体验。

**Independent Test**: 通过视觉检查确认游戏界面符合卡通风格标准。

**Acceptance Scenarios**:

1. **Given** 游戏加载完成，**When** 查看游戏界面，**Then** 看到柔和的渐变背景色（如浅蓝到浅紫）
2. **Given** 方块正在下落，**When** 观察方块外观，**Then** 方块有圆角、阴影效果，每种形状有独特的鲜艳颜色
3. **Given** 游戏界面，**When** 观察装饰元素，**Then** 看到可爱的云朵、星星等装饰
4. **Given** 消除一行，**When** 播放动画，**Then** 有星星飞散的粒子效果
5. **Given** 任何界面，**When** 查看字体，**Then** 使用圆润可爱的字体，易于儿童阅读

---

### User Story 5 - 游戏控制与暂停 (Priority: P2)

小朋友可以随时暂停游戏，暂停时显示暂停界面。支持键盘和触屏两种操作方式，适应不同设备。

**Why this priority**: 暂停功能对于儿童用户非常重要，他们可能随时需要离开。

**Independent Test**: 通过按暂停键验证游戏暂停，通过触屏操作验证移动端支持。

**Acceptance Scenarios**:

1. **Given** 游戏进行中，**When** 按ESC键或点击暂停按钮，**Then** 游戏暂停，显示暂停菜单
2. **Given** 游戏已暂停，**When** 点击继续按钮，**Then** 游戏从暂停处继续
3. **Given** 游戏已暂停，**When** 点击重新开始，**Then** 游戏重置，从头开始
4. **Given** 在移动设备上，**When** 触摸屏幕左侧/右侧，**Then** 方块向左/右移动
5. **Given** 在移动设备上，**When** 向下滑动，**Then** 方块快速下落
6. **Given** 在移动设备上，**When** 点击方块区域，**Then** 方块旋转

---

### User Story 6 - 音效与背景音乐 (Priority: P3)

游戏有欢快的背景音乐和可爱的音效，包括方块移动、旋转、消除、升级等音效。可以单独控制音乐和音效的开关。

**Why this priority**: 音效增强游戏体验，但不是核心功能。

**Independent Test**: 通过进行各种游戏操作验证对应音效播放，通过设置开关验证静音功能。

**Acceptance Scenarios**:

1. **Given** 游戏开始，**When** 进入游戏界面，**Then** 播放欢快的背景音乐
2. **Given** 游戏进行中，**When** 方块移动，**Then** 播放轻柔的移动音效
3. **Given** 游戏进行中，**When** 消除一行，**Then** 播放清脆的消除音效
4. **Given** 升级时，**When** 等级提升，**Then** 播放欢快的升级音效
5. **Given** 设置界面，**When** 关闭背景音乐，**Then** 音乐停止，音效仍然播放
6. **Given** 设置界面，**When** 关闭音效，**Then** 音效停止，音乐仍然播放

---

### User Story 7 - 下一个方块预览 (Priority: P3)

游戏界面显示下一个即将出现的方块，帮助小朋友提前规划。

**Why this priority**: 预览功能提升游戏策略性，但不影响基础游戏体验。

**Independent Test**: 验证预览区域显示正确的下一个方块。

**Acceptance Scenarios**:

1. **Given** 游戏进行中，**When** 查看预览区域，**Then** 显示下一个将要出现的方块
2. **Given** 当前方块落定，**When** 新方块出现，**Then** 预览区域更新为新的下一个方块
3. **Given** 预览区域，**When** 显示方块，**Then** 方块以缩小版本显示，样式与游戏中一致

---

### Edge Cases

- 当浏览器窗口大小改变时，游戏界面应该自适应调整
- 当localStorage不可用时（如隐私模式），应该优雅降级，仍可游戏但不保存记录
- 当方块无法旋转时（空间不足），应该尝试"踢墙"机制或保持原状
- 当网页失去焦点时，应该自动暂停游戏
- 当触摸和键盘同时操作时，应该正确处理冲突
- 当积分溢出时（超过安全整数），应该正确处理

## Requirements

### Functional Requirements

- **FR-001**: 游戏必须能在现代浏览器中运行（Chrome, Firefox, Safari, Edge最新版本）
- **FR-002**: 游戏必须支持键盘控制（方向键、空格键、ESC键）
- **FR-003**: 游戏必须支持触屏控制（适配移动设备）
- **FR-004**: 游戏必须实现标准俄罗斯方块的7种方块形状（I, O, T, S, Z, J, L）
- **FR-005**: 游戏必须实现消行机制，支持1-4行同时消除
- **FR-006**: 游戏必须实现积分系统，根据消除行数计算得分
- **FR-007**: 游戏必须实现等级系统，共10个等级
- **FR-008**: 游戏必须使用localStorage保存历史最高分和最近游戏记录
- **FR-009**: 游戏必须在打破记录时显示烟花庆祝动画
- **FR-010**: 游戏必须实现暂停/继续功能
- **FR-011**: 游戏必须显示下一个方块预览
- **FR-012**: 游戏必须支持音效和背景音乐，并可单独控制开关
- **FR-013**: 游戏界面必须采用卡通风格，色彩明亮友好
- **FR-014**: 游戏必须响应式设计，适配桌面和移动设备

### Non-Functional Requirements

- **NFR-001**: 首次加载时间不超过3秒（网络良好情况下）
- **NFR-002**: 游戏帧率保持60fps，最低不低于30fps
- **NFR-003**: 输入响应延迟不超过16ms
- **NFR-004**: 总资源大小不超过2MB（包括图片和音频）
- **NFR-005**: 支持离线游戏（PWA可选）
- **NFR-006**: 无需后端服务器，纯前端实现

### Key Entities

- **Block（方块）**: 游戏的基本单位，包含形状类型、当前位置、旋转状态、颜色
- **GameBoard（游戏面板）**: 10x20的网格，记录已固定的方块位置
- **Score（积分）**: 当前游戏得分，包含计算规则
- **Level（等级）**: 当前等级，影响下落速度和显示图标
- **HighScore（历史记录）**: 保存在本地存储的历史最高分和最近记录
- **GameState（游戏状态）**: 当前游戏状态（未开始/进行中/暂停/结束）

## Success Criteria

### Measurable Outcomes

- **SC-001**: 游戏加载完成后3秒内可以开始游戏
- **SC-002**: 所有7种方块形状正确渲染和旋转
- **SC-003**: 消行动画在500ms内完成
- **SC-004**: 历史记录在页面刷新后仍然保留
- **SC-005**: 烟花动画在打破记录时正确触发并持续2-3秒
- **SC-006**: 等级图标在升级时正确更新
- **SC-007**: 游戏在主流浏览器（Chrome, Firefox, Safari, Edge）上表现一致
- **SC-008**: 触屏操作响应准确，无误触发
- **SC-009**: 音效和音乐开关功能正常，设置被记住

## 技术建议

### 推荐技术栈

- **HTML5 Canvas** 或 **CSS Grid**: 用于游戏渲染
- **Vanilla JavaScript** 或 **TypeScript**: 游戏逻辑
- **CSS3 Animations**: 用于UI动画和烟花效果
- **Web Audio API**: 用于音效和背景音乐
- **localStorage**: 用于数据持久化

### 文件结构建议

```
/
├── index.html          # 主页面
├── css/
│   ├── style.css       # 主样式
│   └── animations.css  # 动画样式
├── js/
│   ├── game.js         # 游戏主逻辑
│   ├── blocks.js       # 方块定义
│   ├── board.js        # 游戏面板
│   ├── score.js        # 积分系统
│   ├── storage.js      # 本地存储
│   ├── audio.js        # 音频控制
│   └── effects.js      # 特效（烟花等）
├── assets/
│   ├── images/         # 图片资源
│   └── sounds/         # 音效资源
└── README.md           # 说明文档
```

## 视觉设计参考

### 配色方案

- **背景**: 浅蓝到浅紫渐变 (#E0F7FA → #F3E5F5)
- **方块颜色**:
  - I形: 天蓝色 (#4FC3F7)
  - O形: 金黄色 (#FFD54F)
  - T形: 紫色 (#BA68C8)
  - S形: 草绿色 (#81C784)
  - Z形: 珊瑚红 (#FF8A65)
  - J形: 深蓝色 (#64B5F6)
  - L形: 橙色 (#FFB74D)
- **UI元素**: 白色带圆角阴影
- **文字**: 深灰色 (#424242)，使用圆润字体

### 动画效果

- 方块下落: 平滑过渡
- 消行: 闪烁 + 收缩 + 星星粒子
- 升级: 屏幕边缘光效 + 等级图标放大弹跳
- 烟花: 多彩粒子从底部向上爆发，持续2-3秒
- 游戏结束: 方块逐行灰化 + 淡出

