<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="description" content="æ¤ç‰©å¤§æˆ˜åƒµå°¸ç½‘é¡µç‰ˆ - é€‚åˆå„¿ç«¥çš„å¡é€šå¡”é˜²æ¸¸æˆ">
    <!-- ç¦ç”¨ç¼“å­˜ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- å»ºè®®æ¨ªå± -->
    <meta name="screen-orientation" content="landscape">
    <meta name="x5-orientation" content="landscape">
    <title>ğŸŒ» æ¤ç‰©å¤§æˆ˜åƒµå°¸ ğŸ§Ÿ</title>
    <link rel="stylesheet" href="css/main.css?v=20250126b">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ»</text></svg>">
    <!-- ç§»åŠ¨ç«¯å¼ºåˆ¶éšè—ç»Ÿè®¡é¢æ¿ -->
    <style id="mobile-stats-hide">
        @media (max-width: 920px) {
            #game-stats-sidebar,
            #game-stats-sidebar.visible {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                pointer-events: none !important;
            }
            #btn-toggle-stats {
                display: none !important;
                visibility: hidden !important;
            }
        }
    </style>
</head>
<body>
    <!-- ç«–å±æç¤º -->
    <div id="orientation-notice" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.95); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; padding: 20px;">
        <div style="font-size: 60px; margin-bottom: 20px;">ğŸ“± â†»</div>
        <h2 style="font-size: 24px; margin-bottom: 10px;">è¯·æ¨ªå±æ¸¸ç©</h2>
        <p style="font-size: 16px; opacity: 0.8;">ä¸ºäº†è·å¾—æœ€ä½³æ¸¸æˆä½“éªŒï¼Œè¯·å°†è®¾å¤‡æ¨ªå‘</p>
    </div>
    
    <div id="game-container">
        <!-- Loading Screen -->
        <div class="loading-screen" id="loading-screen">
            <h1 class="loading-title">ğŸŒ» æ¤ç‰©å¤§æˆ˜åƒµå°¸ ğŸ§Ÿ</h1>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <p class="loading-text" id="loading-text">æ­£åœ¨åŠ è½½æ¸¸æˆ...</p>
        </div>

        <!-- Game Canvas -->
        <canvas id="game-canvas"></canvas>

        <!-- UI Layer -->
        <div id="ui-layer">
            <!-- Top Bar with Cards -->
            <div class="top-bar" id="top-bar">
                <!-- Sun Counter -->
                <div class="sun-counter">
                    <div class="sun-icon"></div>
                    <span class="sun-value" id="sun-value">50</span>
                </div>

                <!-- Card Bar (æ¤ç‰©å¡ç‰‡ä¼šåŠ¨æ€æ·»åŠ ) -->
                <div class="card-bar" id="card-bar">
                    <!-- Cards will be inserted here -->
                </div>
                
                <!-- Shovel Tool -->
                <div class="shovel-container" id="shovel-container" title="é“²å­ - ç§»é™¤æ¤ç‰©">
                    <div class="shovel-icon">â›ï¸</div>
                </div>

                <!-- Control Buttons -->
                <div class="control-buttons">
                    <button class="btn" id="btn-almanac" title="å›¾é‰´">ğŸ“–</button>
                    <button class="btn" id="btn-pause" title="æš‚åœ">â¸ï¸</button>
                    <button class="btn" id="btn-sound" title="éŸ³æ•ˆ">ğŸ”Š</button>
                    <button class="btn" id="btn-toggle-stats" title="åˆ‡æ¢ç»Ÿè®¡é¢æ¿">ğŸ“Š</button>
                </div>
            </div>
        </div>

        <!-- Menu Screen -->
        <div class="overlay-screen menu-screen" id="menu-screen">
            <h1 class="overlay-title">ğŸŒ» æ¤ç‰©å¤§æˆ˜åƒµå°¸ ğŸ§Ÿ</h1>
            <p class="overlay-subtitle">ä¿æŠ¤ä½ çš„å®¶å›­ï¼</p>
            <div class="menu-stats" id="menu-stats"></div>
            <button class="overlay-btn" id="btn-start">å¼€å§‹æ¸¸æˆ</button>
            <div class="menu-buttons">
                <button class="menu-small-btn" id="btn-difficulty">ğŸ® é€‰æ‹©éš¾åº¦</button>
                <button class="menu-small-btn" id="btn-menu-almanac">ğŸ“– å›¾é‰´</button>
                <button class="menu-small-btn" id="btn-menu-reset">ğŸ”„ é‡ç½®è¿›åº¦</button>
            </div>
        </div>

        <!-- Win Screen -->
        <div class="overlay-screen win-screen" id="win-screen">
            <h1 class="overlay-title">ğŸ‰ èƒœåˆ©å•¦ï¼ğŸ‰</h1>
            <p class="overlay-subtitle">ä½ æˆåŠŸä¿æŠ¤äº†å®¶å›­ï¼</p>
            <div class="star-rating" id="star-rating">
                <span class="star">â­</span>
                <span class="star">â­</span>
                <span class="star">â­</span>
            </div>
            <button class="overlay-btn" id="btn-next">ä¸‹ä¸€å…³</button>
        </div>

        <!-- Lose Screen -->
        <div class="overlay-screen lose-screen" id="lose-screen">
            <h1 class="overlay-title">ğŸ˜¢ åƒµå°¸å…¥ä¾µäº†</h1>
            <p class="overlay-subtitle">åˆ«ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡ï¼</p>
            <button class="overlay-btn" id="btn-retry">é‡æ–°å¼€å§‹</button>
        </div>

        <!-- Pause Screen -->
        <div class="overlay-screen pause-screen" id="pause-screen">
            <h1 class="overlay-title">â¸ï¸ æ¸¸æˆæš‚åœ</h1>
            <div class="pause-buttons">
                <button class="overlay-btn" id="btn-resume">ç»§ç»­æ¸¸æˆ</button>
                <button class="overlay-btn secondary" id="btn-pause-almanac">ğŸ“– æŸ¥çœ‹å›¾é‰´</button>
                <button class="overlay-btn secondary" id="btn-quit">ğŸ  è¿”å›ä¸»èœå•</button>
            </div>
        </div>

        <!-- Reset Confirm Dialog -->
        <div class="overlay-screen confirm-screen" id="confirm-screen">
            <h1 class="overlay-title">âš ï¸ ç¡®è®¤é‡ç½®</h1>
            <p class="overlay-subtitle">è¿™å°†æ¸…é™¤æ‰€æœ‰æ¸¸æˆè¿›åº¦ï¼Œç¡®å®šè¦é‡ç½®å—ï¼Ÿ</p>
            <div class="confirm-buttons">
                <button class="overlay-btn danger" id="btn-confirm-reset">ç¡®è®¤é‡ç½®</button>
                <button class="overlay-btn secondary" id="btn-cancel-reset">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js?v=20250126b"></script>
    
    <!-- ç§»åŠ¨ç«¯å¼ºåˆ¶éšè—ç»Ÿè®¡é¢æ¿è„šæœ¬ -->
    <script>
        (function() {
            function hideMobileStats() {
                // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
                if (window.innerWidth <= 920) {
                    console.log('ğŸš« ç§»åŠ¨ç«¯æ£€æµ‹ - å¼ºåˆ¶éšè—ç»Ÿè®¡é¢æ¿å’Œåˆ‡æ¢æŒ‰é’®');
                    
                    // éšè—ç»Ÿè®¡é¢æ¿
                    const sidebar = document.getElementById('game-stats-sidebar');
                    if (sidebar) {
                        sidebar.style.display = 'none';
                        sidebar.style.visibility = 'hidden';
                        sidebar.style.opacity = '0';
                        sidebar.classList.remove('visible');
                        console.log('âœ… ç»Ÿè®¡é¢æ¿å·²éšè—');
                    }
                    
                    // éšè—åˆ‡æ¢æŒ‰é’®
                    const toggleBtn = document.getElementById('btn-toggle-stats');
                    if (toggleBtn) {
                        toggleBtn.style.display = 'none';
                        toggleBtn.style.visibility = 'hidden';
                        console.log('âœ… åˆ‡æ¢æŒ‰é’®å·²éšè—');
                    }
                } else {
                    console.log('ğŸ’» ç”µè„‘ç«¯æ£€æµ‹ - ç»Ÿè®¡é¢æ¿åŠŸèƒ½æ­£å¸¸');
                }
            }
            
            // é¡µé¢åŠ è½½æ—¶ç«‹å³æ‰§è¡Œ
            hideMobileStats();
            
            // DOMåŠ è½½å®Œæˆåå†æ‰§è¡Œä¸€æ¬¡
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', hideMobileStats);
            }
            
            // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°æ£€æµ‹
            window.addEventListener('resize', hideMobileStats);
            
            // å®šæœŸæ£€æŸ¥ï¼ˆç¡®ä¿é¢æ¿ä¸ä¼šæ„å¤–æ˜¾ç¤ºï¼‰
            setInterval(hideMobileStats, 1000);
        })();
    </script>
    
    <!-- è®¾å¤‡æ£€æµ‹å’Œæ¨ªå±æç¤ºè„šæœ¬ -->
    <script>
        (function() {
            // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
            function isMobileDevice() {
                // æ–¹æ³•1: æ£€æµ‹ User Agent
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                const mobileRegex = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
                const isMobileUA = mobileRegex.test(userAgent);
                
                // æ–¹æ³•2: æ£€æµ‹è§¦æ‘¸æ”¯æŒ
                const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                
                // æ–¹æ³•3: æ£€æµ‹å±å¹•å®½åº¦ï¼ˆå°äº920pxè®¤ä¸ºæ˜¯ç§»åŠ¨è®¾å¤‡ï¼‰
                const isSmallScreen = window.innerWidth <= 920;
                
                // ç»¼åˆåˆ¤æ–­ï¼šæ»¡è¶³ä»»æ„ä¸¤ä¸ªæ¡ä»¶å³è®¤ä¸ºæ˜¯ç§»åŠ¨è®¾å¤‡
                return (isMobileUA && hasTouch) || (isMobileUA && isSmallScreen) || (hasTouch && isSmallScreen);
            }
            
            // æ£€æµ‹æ˜¯å¦ä¸ºç«–å±
            function isPortrait() {
                return window.matchMedia('(orientation: portrait)').matches;
            }
            
            // æ›´æ–°æ¨ªå±æç¤ºæ˜¾ç¤ºçŠ¶æ€
            function updateOrientationNotice() {
                const notice = document.getElementById('orientation-notice');
                const gameContainer = document.getElementById('game-container');
                if (!notice) return;
                
                // åªåœ¨ç§»åŠ¨è®¾å¤‡ä¸”ç«–å±æ—¶æ˜¾ç¤ºæç¤º
                if (isMobileDevice() && isPortrait()) {
                    notice.style.display = 'flex';
                    if (gameContainer) {
                        gameContainer.style.filter = 'blur(10px)';
                        gameContainer.style.pointerEvents = 'none';
                    }
                    console.log('ğŸ“± æ£€æµ‹åˆ°ç§»åŠ¨è®¾å¤‡ç«–å±ï¼Œæ˜¾ç¤ºæ¨ªå±æç¤º');
                } else {
                    notice.style.display = 'none';
                    if (gameContainer) {
                        gameContainer.style.filter = '';
                        gameContainer.style.pointerEvents = '';
                    }
                    if (!isMobileDevice()) {
                        console.log('ğŸ’» æ£€æµ‹åˆ°æ¡Œé¢è®¾å¤‡ï¼Œéšè—æ¨ªå±æç¤º');
                    }
                }
            }
            
            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', updateOrientationNotice);
            } else {
                updateOrientationNotice();
            }
            
            // ç›‘å¬å±å¹•æ–¹å‘å˜åŒ–
            window.addEventListener('orientationchange', function() {
                setTimeout(updateOrientationNotice, 100);
            });
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
            window.addEventListener('resize', function() {
                setTimeout(updateOrientationNotice, 100);
            });
            
            // å®šæœŸæ£€æŸ¥ï¼ˆç¡®ä¿æç¤ºæ­£ç¡®æ˜¾ç¤º/éšè—ï¼‰
            setInterval(updateOrientationNotice, 1000);
        })();
    </script>
</body>
</html>
