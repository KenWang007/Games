<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>ğŸ§ª å®Œæ•´æµ‹è¯•å·¥å…·</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { font-size: 24px; margin-bottom: 20px; text-align: center; }
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            color: #333;
        }
        .card h2 { font-size: 18px; margin-bottom: 15px; color: #667eea; }
        .info-row {
            padding: 8px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }
        .label { font-weight: 600; color: #666; }
        .value { color: #333; font-family: monospace; }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
        }
        .status.ok { background: #10b981; color: white; }
        .status.error { background: #ef4444; color: white; }
        .status.warning { background: #f59e0b; color: white; }
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            background: #10b981;
            color: white;
        }
        .test-canvas {
            border: 2px solid #ddd;
            margin: 10px 0;
            background: white;
        }
        #log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª å®Œæ•´æµ‹è¯•å·¥å…·</h1>
        
        <div class="card">
            <h2>ğŸ“± è®¾å¤‡ä¿¡æ¯</h2>
            <div class="info-row">
                <span class="label">å±å¹•å®½åº¦</span>
                <span class="value" id="width">-</span>
            </div>
            <div class="info-row">
                <span class="label">å±å¹•é«˜åº¦</span>
                <span class="value" id="height">-</span>
            </div>
            <div class="info-row">
                <span class="label">DPRï¼ˆåƒç´ æ¯”ï¼‰</span>
                <span class="value" id="dpr">-</span>
            </div>
            <div class="info-row">
                <span class="label">æ–¹å‘</span>
                <span class="value" id="orientation">-</span>
            </div>
            <div class="info-row">
                <span class="label">User Agent</span>
                <span class="value" id="ua" style="font-size: 10px; word-break: break-all;">-</span>
            </div>
        </div>
        
        <div class="card">
            <h2>âœ… æµ‹è¯•ç»“æœ</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="card">
            <h2>ğŸ¨ Canvasæ¸…æ™°åº¦æµ‹è¯•</h2>
            <p style="margin-bottom: 10px; font-size: 14px;">ä¸‹é¢çš„æ–‡å­—åº”è¯¥æ¸…æ™°å¯è¯»ï¼Œå¦‚æœæ¨¡ç³Šè¯´æ˜é«˜DPIæœªç”Ÿæ•ˆï¼š</p>
            <canvas id="test-canvas" class="test-canvas" width="600" height="100"></canvas>
        </div>
        
        <div class="card">
            <h2>ğŸ“‹ æ§åˆ¶å°æ—¥å¿—</h2>
            <div id="log"></div>
        </div>
        
        <div class="card">
            <button class="btn" onclick="location.href='index.html'">æ‰“å¼€æ¸¸æˆ</button>
            <button class="btn" onclick="location.reload()">é‡æ–°æµ‹è¯•</button>
        </div>
    </div>
    
    <script>
        const log = (msg) => {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${msg}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        };
        
        function runTests() {
            // è·å–è®¾å¤‡ä¿¡æ¯
            const width = window.innerWidth;
            const height = window.innerHeight;
            const dpr = window.devicePixelRatio || 1;
            const isPortrait = window.matchMedia('(orientation: portrait)').matches;
            const orientation = isPortrait ? 'ç«–å± ğŸ“±' : 'æ¨ªå± ğŸ“±â†»';
            const ua = navigator.userAgent;
            
            // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
            document.getElementById('width').textContent = width + 'px';
            document.getElementById('height').textContent = height + 'px';
            document.getElementById('dpr').textContent = dpr + 'x';
            document.getElementById('orientation').textContent = orientation;
            document.getElementById('ua').textContent = ua;
            
            log(`è®¾å¤‡ä¿¡æ¯: ${width}x${height}, DPR=${dpr}, ${orientation}`);
            
            // è¿è¡Œæµ‹è¯•
            const results = [];
            
            // æµ‹è¯•1: DPIæ£€æµ‹
            if (dpr >= 2) {
                results.push({
                    name: 'DPIæ£€æµ‹',
                    status: 'ok',
                    message: `é«˜DPIå±å¹• (${dpr}x)ï¼Œéœ€è¦ä¼˜åŒ–`
                });
                log(`âœ… é«˜DPIå±å¹•æ£€æµ‹: ${dpr}x`);
            } else {
                results.push({
                    name: 'DPIæ£€æµ‹',
                    status: 'ok',
                    message: `æ ‡å‡†DPIå±å¹• (${dpr}x)`
                });
                log(`â„¹ï¸ æ ‡å‡†DPIå±å¹•: ${dpr}x`);
            }
            
            // æµ‹è¯•2: ç§»åŠ¨ç«¯æ£€æµ‹
            const isMobile = width <= 920;
            if (isMobile) {
                results.push({
                    name: 'ç§»åŠ¨ç«¯æ£€æµ‹',
                    status: 'ok',
                    message: 'ç§»åŠ¨è®¾å¤‡ - ç»Ÿè®¡é¢æ¿åº”éšè—'
                });
                log(`âœ… ç§»åŠ¨ç«¯æ£€æµ‹: ${width}px â‰¤ 920px`);
            } else {
                results.push({
                    name: 'è®¾å¤‡æ£€æµ‹',
                    status: 'ok',
                    message: 'æ¡Œé¢è®¾å¤‡ - ç»Ÿè®¡é¢æ¿å¯ç”¨'
                });
                log(`â„¹ï¸ æ¡Œé¢è®¾å¤‡: ${width}px > 920px`);
            }
            
            // æµ‹è¯•3: æ¨ªå±æ£€æµ‹
            if (isMobile && isPortrait) {
                results.push({
                    name: 'æ¨ªå±æç¤º',
                    status: 'warning',
                    message: 'ç«–å±æ¨¡å¼ - åº”è¯¥æ˜¾ç¤ºæ¨ªå±æç¤º'
                });
                log(`âš ï¸ ç§»åŠ¨ç«¯ç«–å±: åº”æ˜¾ç¤ºæ¨ªå±æç¤º`);
            } else if (isMobile && !isPortrait) {
                results.push({
                    name: 'æ¨ªå±æ£€æµ‹',
                    status: 'ok',
                    message: 'æ¨ªå±æ¨¡å¼ - æ­£å¸¸æ¸¸ç©'
                });
                log(`âœ… ç§»åŠ¨ç«¯æ¨ªå±: å¯æ­£å¸¸æ¸¸ç©`);
            }
            
            // æµ‹è¯•4: Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(regs => {
                    if (regs.length > 0) {
                        results.push({
                            name: 'Service Worker',
                            status: 'warning',
                            message: `å‘ç°${regs.length}ä¸ªSW - å¯èƒ½ç¼“å­˜æ—§ç‰ˆæœ¬`
                        });
                        log(`âš ï¸ Service Worker: ${regs.length}ä¸ª`);
                    } else {
                        results.push({
                            name: 'Service Worker',
                            status: 'ok',
                            message: 'æ— Service Worker - æ— ç¼“å­˜'
                        });
                        log(`âœ… æ— Service Worker`);
                    }
                    updateResults(results);
                });
            }
            
            // æµ‹è¯•5: ç¼“å­˜
            if ('caches' in window) {
                caches.keys().then(names => {
                    if (names.length > 0) {
                        results.push({
                            name: 'ç¼“å­˜',
                            status: 'warning',
                            message: `å‘ç°${names.length}ä¸ªç¼“å­˜`
                        });
                        log(`âš ï¸ ç¼“å­˜: ${names.join(', ')}`);
                    } else {
                        results.push({
                            name: 'ç¼“å­˜',
                            status: 'ok',
                            message: 'æ— ç¼“å­˜'
                        });
                        log(`âœ… æ— ç¼“å­˜`);
                    }
                    updateResults(results);
                });
            }
            
            // æµ‹è¯•Canvasé«˜DPI
            testCanvas();
            
            // åˆæ¬¡æ˜¾ç¤ºç»“æœ
            updateResults(results);
        }
        
        function updateResults(results) {
            const resultsDiv = document.getElementById('test-results');
            let html = '';
            results.forEach(r => {
                html += `<div><span class="status ${r.status}">${r.name}</span> ${r.message}</div>`;
            });
            resultsDiv.innerHTML = html;
        }
        
        function testCanvas() {
            const canvas = document.getElementById('test-canvas');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            
            // åº”ç”¨é«˜DPI
            canvas.width = 600 * dpr;
            canvas.height = 100 * dpr;
            canvas.style.width = '600px';
            canvas.style.height = '100px';
            ctx.scale(dpr, dpr);
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            // ç»˜åˆ¶æµ‹è¯•å†…å®¹
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, 600, 100);
            
            ctx.fillStyle = '#333';
            ctx.font = 'bold 24px Arial';
            ctx.fillText('é«˜DPIæµ‹è¯• - è¿™æ®µæ–‡å­—åº”è¯¥æ¸…æ™°', 20, 40);
            
            ctx.font = '16px Arial';
            ctx.fillText(`DPR=${dpr}, Canvas=${canvas.width}x${canvas.height}`, 20, 70);
            
            log(`Canvasæµ‹è¯•: DPR=${dpr}, åˆ†è¾¨ç‡=${canvas.width}x${canvas.height}`);
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿è¡Œ
        window.addEventListener('load', runTests);
        window.addEventListener('resize', runTests);
        window.addEventListener('orientationchange', () => setTimeout(runTests, 100));
    </script>
</body>
</html>

