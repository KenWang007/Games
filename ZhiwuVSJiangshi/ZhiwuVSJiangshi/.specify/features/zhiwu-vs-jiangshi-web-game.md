# Feature Specification: 植物大战僵尸网页版游戏

**Feature Branch**: `001-zhiwu-vs-jiangshi-web-game`  
**Created**: 2025-12-24  
**Status**: Draft  
**Input**: User description: "帮我实现一个植物大战僵尸的网页版游戏，适合10岁以下小朋友玩，操作简单，画面卡通友好，可玩性比较好"

## 项目概述

为10岁以下儿童设计的网页版塔防游戏，采用可爱卡通风格，操作简单直观，具有良好的可玩性和教育意义。游戏核心是通过种植各种植物来防御僵尸入侵，保护家园。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 基础游戏体验 (Priority: P1)

作为一名小朋友，我希望能够在草坪上种植植物来阻挡僵尸，这样我可以体验保护家园的乐趣。

**Why this priority**: 这是游戏的核心玩法，没有这个功能游戏无法运行。必须首先实现才能验证游戏概念。

**Independent Test**: 可以通过打开游戏页面，拖拽植物到草坪，观察僵尸被击退来完整测试。即使只有1种植物和1种僵尸也能提供完整的游戏体验。

**Acceptance Scenarios**:

1. **Given** 游戏已加载完成, **When** 玩家点击/拖拽向日葵到草坪格子, **Then** 向日葵出现在该格子并开始产生阳光
2. **Given** 草坪上有豌豆射手, **When** 僵尸进入该行, **Then** 豌豆射手自动发射豌豆攻击僵尸
3. **Given** 僵尸血量归零, **When** 僵尸被击败, **Then** 僵尸消失并播放可爱的消失动画
4. **Given** 所有僵尸被消灭, **When** 本波结束, **Then** 显示胜利画面并奖励小星星

---

### User Story 2 - 阳光收集系统 (Priority: P1)

作为一名小朋友，我希望能够点击收集阳光来获取种植植物的资源，这样我可以学习资源管理的概念。

**Why this priority**: 阳光是游戏经济系统的核心，决定了玩家能种植什么植物，是策略玩法的基础。

**Independent Test**: 可以通过点击天空掉落的阳光和向日葵产生的阳光，观察阳光数值增加来测试。

**Acceptance Scenarios**:

1. **Given** 游戏开始, **When** 天空定期掉落阳光, **Then** 阳光缓慢飘落并可被点击收集
2. **Given** 向日葵已种植, **When** 每隔一定时间, **Then** 向日葵产生阳光并弹出可收集
3. **Given** 阳光在屏幕上, **When** 玩家点击阳光, **Then** 阳光飞向阳光计数器并增加25点
4. **Given** 阳光未被收集, **When** 超过10秒, **Then** 阳光渐渐消失（给小朋友充足时间）

---

### User Story 3 - 植物选择卡片系统 (Priority: P1)

作为一名小朋友，我希望能从卡片栏选择不同的植物来种植，这样我可以使用不同策略来对抗僵尸。

**Why this priority**: 植物选择是玩家表达策略的主要方式，是游戏可玩性的关键组成部分。

**Independent Test**: 可以通过点击不同植物卡片，观察选中状态变化，然后种植到草坪来测试。

**Acceptance Scenarios**:

1. **Given** 游戏界面显示, **When** 玩家查看顶部卡片栏, **Then** 看到可用植物卡片及其阳光消耗
2. **Given** 阳光充足, **When** 玩家点击植物卡片, **Then** 卡片高亮显示为选中状态
3. **Given** 阳光不足, **When** 玩家点击植物卡片, **Then** 卡片显示灰色并轻微抖动提示
4. **Given** 植物刚种植完, **When** 卡片进入冷却, **Then** 显示冷却进度条（儿童友好的可视化）

---

### User Story 4 - 关卡进度系统 (Priority: P2)

作为一名小朋友，我希望能够逐步挑战不同难度的关卡，这样我可以获得成就感并持续游玩。

**Why this priority**: 关卡系统提供游戏目标和进度感，是长期可玩性的保障，但核心玩法完成后才需要。

**Independent Test**: 可以通过完成第一关，观察解锁第二关，进入新关卡体验不同难度来测试。

**Acceptance Scenarios**:

1. **Given** 玩家首次进入游戏, **When** 查看关卡选择界面, **Then** 只有第一关可选，其他关卡显示锁定图标
2. **Given** 玩家完成某关卡, **When** 胜利结算, **Then** 下一关解锁并显示解锁动画
3. **Given** 玩家进入新关卡, **When** 游戏开始, **Then** 僵尸类型和数量根据关卡难度调整
4. **Given** 玩家想重玩, **When** 点击已完成关卡, **Then** 可以重新挑战并尝试获得更多星星

---

### User Story 5 - 新手引导教程 (Priority: P2)

作为一名小朋友，我希望游戏能教我怎么玩，这样我可以快速上手而不会感到困惑。

**Why this priority**: 对于10岁以下儿童，清晰的引导至关重要，但可以在核心玩法完成后添加。

**Independent Test**: 可以通过首次进入游戏，跟随教程指引完成种植第一株植物来测试。

**Acceptance Scenarios**:

1. **Given** 玩家首次进入游戏, **When** 第一关开始, **Then** 出现可爱的引导角色和对话框
2. **Given** 教程进行中, **When** 需要玩家操作, **Then** 高亮目标区域并显示手指点击动画
3. **Given** 玩家完成教程步骤, **When** 操作正确, **Then** 引导角色给予鼓励并进入下一步
4. **Given** 玩家已完成教程, **When** 再次进入游戏, **Then** 不再显示教程（可在设置中重新开启）

---

### User Story 6 - 音效与背景音乐 (Priority: P2)

作为一名小朋友，我希望游戏有欢快的音乐和有趣的音效，这样游戏体验更加愉快。

**Why this priority**: 音效增强游戏沉浸感和反馈，对儿童吸引力很重要，但不影响核心玩法。

**Independent Test**: 可以通过进入游戏听到背景音乐，种植植物和收集阳光时听到音效来测试。

**Acceptance Scenarios**:

1. **Given** 游戏加载完成, **When** 进入主界面, **Then** 播放欢快的背景音乐
2. **Given** 玩家种植植物, **When** 植物放置成功, **Then** 播放"噗"的可爱种植音效
3. **Given** 玩家收集阳光, **When** 点击阳光, **Then** 播放清脆的收集音效
4. **Given** 玩家想安静游玩, **When** 点击音量按钮, **Then** 可以分别控制音乐和音效开关

---

### User Story 7 - 植物图鉴收集 (Priority: P3)

作为一名小朋友，我希望能查看我解锁的所有植物和它们的介绍，这样我可以了解每种植物的特点。

**Why this priority**: 图鉴系统增加收集乐趣和教育价值，但是附加功能，不影响核心游戏体验。

**Independent Test**: 可以通过打开图鉴界面，查看已解锁植物的图片和描述来测试。

**Acceptance Scenarios**:

1. **Given** 玩家点击图鉴按钮, **When** 图鉴界面打开, **Then** 显示所有植物卡片（未解锁的显示剪影）
2. **Given** 玩家点击已解锁植物, **When** 查看详情, **Then** 显示植物动画、名称、能力描述和趣味小知识
3. **Given** 玩家解锁新植物, **When** 首次获得, **Then** 显示"新植物get!"的庆祝动画

---

### User Story 8 - 游戏存档系统 (Priority: P3)

作为一名小朋友，我希望我的游戏进度能被保存，这样下次打开游戏时可以继续玩。

**Why this priority**: 存档功能对于长期游玩体验重要，但初期可以每次重新开始。

**Independent Test**: 可以通过完成几关后关闭浏览器，重新打开后检查进度是否保留来测试。

**Acceptance Scenarios**:

1. **Given** 玩家完成关卡, **When** 游戏自动保存, **Then** 进度存储到浏览器本地存储
2. **Given** 玩家重新打开游戏, **When** 游戏加载, **Then** 自动读取存档并恢复进度
3. **Given** 玩家想重新开始, **When** 点击重置按钮, **Then** 显示确认对话框防止误操作

---

### Edge Cases

- 当浏览器不支持本地存储时，显示友好提示并允许无存档游玩
- 当网络断开时（如果有在线功能），游戏继续离线运行
- 当屏幕尺寸过小时，显示建议横屏或使用更大屏幕的提示
- 当玩家快速连续点击时，防止重复种植或收集
- 当僵尸到达房子边缘时，显示可爱的"再试一次"画面而非恐怖的失败画面
- 当玩家长时间不操作时，显示温馨的暂停提示

## Requirements *(mandatory)*

### Functional Requirements

#### 游戏核心
- **FR-001**: 系统必须提供5x9的草坪网格作为游戏场地
- **FR-002**: 系统必须支持至少5种基础植物（向日葵、豌豆射手、坚果墙、寒冰射手、双发射手）
- **FR-003**: 系统必须支持至少3种基础僵尸（普通僵尸、路障僵尸、铁桶僵尸）
- **FR-004**: 系统必须实现阳光资源系统，初始阳光为50
- **FR-005**: 系统必须实现植物攻击和僵尸受伤的碰撞检测

#### 用户界面
- **FR-006**: 系统必须提供清晰的植物选择卡片栏
- **FR-007**: 系统必须显示当前阳光数量
- **FR-008**: 系统必须提供暂停/继续按钮
- **FR-009**: 系统必须提供音量控制按钮
- **FR-010**: 系统必须适配桌面和平板设备（最小宽度768px）

#### 游戏流程
- **FR-011**: 系统必须提供至少10个循序渐进的关卡
- **FR-012**: 系统必须在每关开始前显示即将出现的僵尸类型
- **FR-013**: 系统必须在关卡结束时显示结算界面和星级评价
- **FR-014**: 系统必须保存玩家进度到本地存储

#### 儿童友好
- **FR-015**: 所有视觉元素必须采用圆润可爱的卡通风格
- **FR-016**: 游戏失败画面必须温和友好，鼓励再次尝试
- **FR-017**: 游戏节奏必须适中，给予儿童充足反应时间
- **FR-018**: 系统必须提供新手引导教程

### Key Entities

- **Plant（植物）**: 游戏核心防御单位，具有类型、生命值、攻击力、攻击间隔、阳光消耗、冷却时间等属性
- **Zombie（僵尸）**: 游戏敌方单位，具有类型、生命值、移动速度、攻击力等属性
- **Sun（阳光）**: 游戏货币资源，用于种植植物
- **Level（关卡）**: 游戏进度单位，定义僵尸波次、可用植物、胜利条件等
- **Grid（草坪格子）**: 游戏场地单元，可放置一株植物
- **Projectile（子弹）**: 植物发射的攻击物，具有伤害值和移动速度

## 技术规格

### 技术栈
- **前端框架**: 原生HTML5 + CSS3 + JavaScript（考虑到简单性和无需构建）
- **游戏引擎**: HTML5 Canvas 2D
- **动画**: CSS动画 + requestAnimationFrame
- **存储**: localStorage
- **音频**: Web Audio API

### 性能要求
- 游戏必须在主流浏览器（Chrome、Safari、Firefox、Edge）流畅运行
- 帧率目标：60fps，最低可接受：30fps
- 首次加载时间：< 3秒（不含资源）
- 内存占用：< 100MB

### 视觉风格指南
- **色彩**: 明亮饱和的色彩，绿色草坪、蓝色天空、彩色植物
- **线条**: 粗描边卡通风格，2-3px黑色描边
- **表情**: 所有角色都有可爱的表情，僵尸也要萌萌的
- **动画**: 流畅的弹跳和摇摆动画，增加活力感

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 10岁以下儿童能在无成人帮助下完成教程并开始游戏
- **SC-002**: 玩家能在首次游玩时成功通过第一关
- **SC-003**: 游戏在60fps下稳定运行，无明显卡顿
- **SC-004**: 单次游戏session平均时长超过10分钟（表明游戏有吸引力）
- **SC-005**: 游戏加载完成到可操作时间小于5秒
- **SC-006**: 所有交互元素点击区域不小于44x44像素（适合儿童操作）

## 开发阶段规划

### Phase 1: 核心游戏循环 (MVP)
- 基础草坪渲染
- 向日葵和豌豆射手
- 普通僵尸
- 阳光收集系统
- 基础胜负判定

### Phase 2: 完整游戏体验
- 更多植物类型
- 更多僵尸类型
- 关卡系统
- 植物卡片和冷却
- 音效和背景音乐

### Phase 3: 润色和附加功能
- 新手引导教程
- 植物图鉴
- 存档系统
- 视觉特效优化
- 性能优化

